
Helpers = {"Noooooooorr#0000","Cyanny#0000","Heba#4782"}

lang={}
lang.ar={
	ZalekhaName="زليخة",
	ModuleName="إنقاذ القائدة",
	Welcome="~ ~ ~مرحباً بك في غرفة مغامرة إنقاذ القائدة ~ ~ ~ \nفي هذا المغامرة يجب أن تكون شجاعًا .. لديك الكثير من المرح والتسلية \n يبدوا عليها ملامح الخوف و الحزن<font color='#cf3872'> Heba <CE>قم بالتحدث إلى\n",
	DropKey="لقد سقط المفتاح من",
	HoldTheKey="!!مفتاح القفص ,لنذهب ونخرج القائدة الأن",
	HoldTheKey1="لقد إلتقط",
	GoTakeKey="!!!إذهب و إلتقطه بسرعة",
	KeyTime="!!لديك وقت محدد فقط و سيسقط المفتاح منك",
	KeyWillDropSoon="...سيسقط المفتاح قريبا",
	ZalekhaChat = {"!إبتعدوا عني","سوف تهلكون","لن تأخذوها","ستندمون على فعلتكم","سأقتلكم جميعاً","إبتعدوا هيا"},
	ImFree = "واااو , أنا حرة الآن",
	ThanksYou = "شكرًا لكم",
	LetsParty = "الأن يمكننا إقامة الحفل واللعب",
	LetsGo = "لنخرج من الغابة ونبدأ المرح والتسلية",
	WeAreSafeNow = "<font color='#F28662'>!!نحن في مأمن الأن ، هيّا لنحتفل \n <font color='#FF6B00'>Ragekitteee<font color='#F28662'> يمكنك تغيير حجم الفأر الخاص بك ، تحدث مع",
	Massi1="<font color='#f6e2bd'> ستندمون على دخولكم منطقتي، لن تخرجوا أحياءً من هنا <font color='#a4bd5f'>[ماسي]\n <font color='#FEF7BF'>",
	Massi2="<font color='#f6e2bd'> !!لا تفرحوا كثيرًا هذه ليست إلا البداية فقط .. سأخبر الزعيمة بقدومكم<font color='#a4bd5f'>[ماسي]",
	MassiFight="قم باللإقتراب و ضغط زر [المسطرة/المسافة] لمواجهة ماسي",
	ZlekhaFight = "قم باللإقتراب و ضغط زر [المسطرة/المسافة] لمواجهة زليخة ",
	Zalekha1="<font color='#FEF7BF'>يا إلاهي أنتم شجعان حقًا <font color='#F0E47C'>[زليخة]\n <font color='#FEF7BF'>!يمكنكم انقاذ القائدة هذه المرة .. لكنني سأعود مرة أخرى<font color='#F0E47C'> [زليخة] ",
	Zalekha2="<font color='#FEF7BF'> ما هذا !! من أنتم !! كيف تجرؤون على دخول منطقتي هاه ؟؟ <font color='#F0E47C'>[زليخة]\n <font color='#FEF7BF'> !!لن تأخدوا القائدة الحمقاء دون مواجهتي .. سأقتلكم جميعًا<font color='#F0E47C'>[زليخة] \n",
	Noor = "<p align='center'><font size='13'>أبطالي الفئران الشجاعة \n  كنت واثقة من قدومكم لمساعدتي",
	Noor1= "إنها شريرة حقًا\n  شكرًا لكم .. لكن أنا عالقة هنا",
	Noor2="لن أستطيع الخروج من هذا القفص دون المفتاح",
	Noor3="ساعدوني في البحث عنه \n سأقوم بتقديم مكافئة لمن يجد هذا المفتاح  \n و يخرجني من هنا",
	SearchForCageKey="حان وقت البحث ، قم بإيجاد المفتاح لإخراج نور من القفص",
	ChangeYourSize="!!مرحباً، يمكنك هنا إختيار حجم الفأر المناسب لك",
	VerySmall=" صغير جداً ",
	Small=" صغير ",
	Normal=" متوسط ",
	Big=" كبير ",
	VeryBig=" كبير جداً ",
	HebaCantTalk="هنالك عملية خطف القائدة!! .. ربما ربما  \n أوووه .. أنا خائفة ومتوترة لا أستطيع الكلام",
	HebaGoAndTalkWithCyanny="إذهب وتحدث مع سياني، ستشرح لك ماذا حدث  \nستجدها في الغابة فوق الصخور ",
	CyannyFinallyHelp="هااااه وأخيرًا .. لقد جاءت المساعدة",
	Cyanny="هناك مجموعة من الخاطفين قامو بخطف القائدة نور \n قامو بتعذيبها وسجنها داخل القفص, نحتاج \n مساعدتك في إنقاذها",
	CyannyGoToForest="قم بدخول الغابة المخيفة ، كن حذِرًا من الخاطفين",
	OpenNoorCage="!!حرر نور من القفص %s",
	WaitToTakeTheKey="إنتظر قليلا لأخذ المفتاح مرة أخرى"
}

lang.en={
	ZalekhaName="Zalekha",
	ModuleName="The lost leader",
	Welcome=" ~ ~ ~ Hello and welcome to #thelostleader ~ ~ ~\n In this adventure you have to be brave .. you'll have many of fun in this game \n<CE>Go and talk to <font color='#cf3872'> Heba <CE> she shows signs of fear and sadness \n ",
	HoldTheKey=".",
	HoldTheKey1="picked up the key , lets free the leader!",
	DropKey="go and take it quickly!",
	GoTakeKey="The key falled from",
	KeyTime="You have a little moments then the key'll fall from you",
	KeyWillDropSoon="The key will fall soon...",
	ZalekhaChat = {"Go away!","You'll die!","I'll kill you","You'll regret it","You won't take the leader"},
	ImFree = "WoOah , I'm free now!",
	ThanksYou = "Thanks you",
	LetsParty = "Now we can make a party and play!",
	LetsGo = "Let's go outside the forest and make the party begin!",
	WeAreSafeNow = "<font color='#F28662'>We're safe now , lets party! \n You can change your mouse size,go and talk with <font color='#FF6B00'>Ragekitteee <font color='#F28662'> to do that",
	Massi1="<font color='#a4bd5f'>[Massi]<font color='#f6e2bd'> You will regret your entry to my area, you will not come out alive from here!!\n <font color='#FEF7BF'>",
	Massi2="<font color='#a4bd5f'>[Massi]<font color='#f6e2bd'> Don't be too happy !! This is only the beginning .. I will tell the boss about your arrival",
	MassiFight="Go near Massi and click on [Space] to fight him ",
	ZlekhaFight = "Go near Zalekha and click on [Space] to fight her ",
	Zalekha1="<font color='#F0E47C'>[Zalekha] <font color='#FEF7BF'>OMG you're really brave! \n <font color='#F0E47C'>[Zalekha]<font color='#FEF7BF'>You can take the leader .. but I'll back soon!! ",
	Zalekha2="<font color='#F0E47C'>[Zalekha]<font color='#FEF7BF'>Who are you ? how you get here? \n <font color='#F0E47C'>[Zalekha] <font color='#FEF7BF'> you won't take the stupid leader from me , you'll die! \n",
	Noor = "<p align='center'><font size='13'>My heroes! \n I was sure you'll came to help me",
	Noor1= "She's an evil \n  thanks you but I can't get out from here",
	Noor2="I need a key to get out from the cage",
	Noor3="Help me and find it",
	SearchForCageKey="It's searching time , go and search for the key to help Noor to get out from the cage",
	ChangeYourSize="Hello , you can choose your mouse size here!",
	VerySmall=" Very Small ",
	Small=" Small ",
	Normal=" Normal ",
	Big=" Big ",
	VeryBig=" Too Big ",
	HebaCantTalk="There is a kidnapping,The leader ..maybe ,maybe!! \n Oohh Noo , I'm really afraid and tense i can't talk right now ",
	HebaGoAndTalkWithCyanny="Go and talk to Cyanny ,she'll explain everything \n you'll find her in the forest ",
	CyannyFinallyHelp="Yaah Finally , the help is here!",
	Cyanny="Noor was kidnapped by a dangerous people\nThey put her in the cage and tortured her\nWe need your help to save her",
	CyannyGoToForest="Go to the terrifying forest and be careful from the kidnappers",
	OpenNoorCage="%s free Noor from the cage ",
	WaitToTakeTheKey="Wait a few moments to take the key again"
}

local text = {}
local imgs = {}
local FindKey1 = 0
local e = 0
local y = 0
local u = 0
local C=0
local Game = 0
local TheEnd = 0
local TakerChat = 0

local teleport = {
	--{fromX, fromY, distanceX, teleportToX, teleportToY},
	{3451, 1519, 100, 4575, 1333},
	{5230, 1150, 60, 7430, 1795},
	{6450, 1800, 55, 8970, 560},
	{8285, 510, 75, 2550, 550},

	{2635, 550, 50, 8383, 530,true},
	{9043, 550, 60, 6520, 1791,true},
	{7500, 1800, 50, 5096, 1165,true}, 
	{4540, 1300, 30, 3322, 1475,true}
}

local bosses = {
	massi = {
		health = 100,
		damage = 2,
		killing = false,
		fighting = false,
		talking = 0,
		img = nil,
	},
	zalekha = {
		health = 100,
		damage = 1,
		fighting = false, 
		killing = false,
		talking = 0 ,
		going = nil,
		img = nil
	}
}

local game = {
	taker = {}, 
	keyInfo = {x = 5197 , y = 1431 , finder = {} },
	inRoom = 0,
	sizes = {VerySmall = 0.25, Small = 0.5, Normal = 1, Big = 2, VeryBig = 4}
}

Massi = {}
Massi2 = {}

Ragee = {}
Map1 = true 

NoorCrying1 = {}
NoorCrying2 = {}
NoorCage = {}
Noor = ""

Zalekha = {}
Zalekha1 = {}
Zalekha2 = {}
Zalekha3 = {}

KeyTakeP = {}
HebaImg = {}
HebaBig = {}
Cyanny = {}

Taker = {}
KeyFinder = {}
Final = false
Finder = {}


tfm.exec.disableAutoShaman(true)
tfm.exec.disableAfkDeath(true)
tfm.exec.disableAutoNewGame(true)
tfm.exec.disablePhysicalConsumables(true)
tfm.exec.disableDebugCommand(true)
tfm.exec.disableMortCommand(true)
system.disableChatCommandDisplay(nil,true) 

tfm.exec.newGame([[<C><P lua="" Ca="" H="2800" L="14000" D=",0,0"/><Z><S><S i="7600,10,1702b46da7c.png"/><S i="6000,800,1702b3624e9.png"/><S N="" i="6000,800,1702af8c23c.png"/><S i="4300,1000,17029ab777a.png"/><S i="0,0,1701ae69c22.png"/><S N="" i="0,0,1701ae9f9d6.png"/><S i="0,1000,1702077a2c3.png"/><S N="" i="0,1000,170207d8fc2.png"/><S i="3162,1373,170277320c8.png"/><S X="262" Y="649" T="5" L="536" H="142" P="0,0,0.3,0.2,6,0,0,0" m=""/><S X="545" Y="670" T="5" L="536" H="142" P="0,0,0.3,0.2,0,0,0,0" m=""/><S X="663" Y="1658" T="5" L="536" H="142" P="0,0,0.3,0.2,7,0,0,0" m=""/><S X="556" Y="1623" T="5" L="536" H="142" P="0,0,0.3,0.2,12,0,0,0" m=""/><S X="1165" Y="1686" T="5" L="817" H="142" P="0,0,0.3,0.2,0,0,0,0" m=""/><S X="1777" Y="1622" T="5" L="817" H="142" P="0,0,0.3,0.2,-11,0,0,0" m=""/><S X="2725" Y="1546" T="5" L="1136" H="142" P="0,0,0.3,0.2,0,0,0,0" m=""/><S X="3893" Y="1820" T="5" L="1136" H="142" P="0,0,0.3,0.2,26,0,0,0" m=""/><S X="3337" Y="1561" T="5" L="130" H="142" P="0,0,0.3,0.2,15,0,0,0" m=""/><S X="630" Y="702" T="5" L="536" H="142" P="0,0,0.3,0.2,-10,0,0,0" m=""/><S X="1141" Y="657" T="5" L="536" H="142" P="0,0,0.3,0.2,0,0,0,0" m=""/><S X="1439" Y="613" T="5" L="810" H="137" P="0,0,0.3,0.2,-7,0,0,0" m=""/><S X="2213" Y="634" T="5" L="810" H="137" P="0,0,0.3,0.2,10,0,0,0" m=""/><S X="2498" Y="651" T="5" L="810" H="137" P="0,0,0.3,0.2,0,0,0,0" m=""/><S X="2727" Y="241" T="5" L="810" H="137" P="0,0,0,0,-90,0,0,0" m=""/><S X="311" Y="274" T="5" L="810" H="137" P="0,0,0,0,-90,0,0,0" m=""/><S X="339" Y="1410" T="5" L="810" H="137" P="0,0,0,0,-90,0,0,0" m=""/><S X="3539" Y="1387" T="5" L="810" H="137" P="0,0,0,0,-90,0,0,0" m=""/><S X="400" Y="1505" T="13" L="132" H="61" o="324650" P="0,0,2,0.2,0,0,0,0" m="" N=""/><S X="426" Y="1440" T="13" L="67" H="31" o="324650" P="0,0,0.3,0.2,0,0,0,0" N="" m=""/><S X="709" Y="157" T="5" L="810" H="447" P="0,0,0,0,0,0,0,0" m=""/><S X="4486" Y="1348" T="5" L="810" H="137" P="0,0,0,0,-90,0,0,0" m=""/><S X="5824" Y="1389" T="5" L="1021" H="1192" P="0,0,0,0,-90,0,0,0" m=""/><S X="8041" Y="1451" T="5" L="1021" H="1041" P="0,0,0,0,-90,0,0,0" m=""/><S X="4625" Y="1374" T="5" L="142" H="37" P="0,0,0.3,0.2,0,0,0,0" m=""/><S X="4620" Y="1413" T="5" L="142" H="37" P="0,0,0.3,0.2,-30,0,0,0" m=""/><S X="4611" Y="1448" T="5" L="142" H="37" P="0,0,0.3,0.2,-70,0,0,0" m=""/><S X="4906" Y="1471" T="9" L="614" H="36" P="0,0,0,0,0,0,0,0" c="4" m=""/><S X="4909" Y="1502" T="5" L="638" H="37" P="0,0,0.3,0.2,0,0,0,0" m=""/><S X="4803" Y="1457" T="5" L="55" H="10" P="0,0,0.3,0.2,0,0,0,0" m=""/><S X="4934" Y="1429" T="5" L="110" H="10" P="0,0,0.8,0.2,-75,0,0,0" m=""/><S X="4946" Y="1370" T="5" L="38" H="10" P="0,0,0.3,0.2,-155,0,0,0" m=""/><S X="4969" Y="1396" T="5" L="62" H="37" P="0,0,4,0.2,-95,0,0,0" m=""/><S X="4985" Y="1450" T="5" L="56" H="34" P="0,0,0.6,0.2,-85,0,0,0" m=""/><S X="5004" Y="1475" T="5" L="56" H="34" P="0,0,0.6,0.2,-85,0,0,0" m=""/><S X="4962" Y="1352" T="5" L="72" H="28" P="0,0,2,0.2,-5,0,0,0" m=""/><S X="4901" Y="1281" T="15" L="10" H="59" P="0,0,0,0,0,0,0,0" c="4" m=""/><S X="4901" Y="1189" T="5" L="169" H="20" P="0,0,2,0.2,-90,0,0,0" m=""/><S X="4913" Y="1081" T="5" L="728" H="20" P="0,0,0,0.2,-180,0,0,0" m=""/><S X="5198" Y="1203" T="5" L="204" H="32" P="0,0,6,0.2,-6,0,0,0" m=""/><S X="5106" Y="1247" T="4" L="10" H="84" P="0,0,20,0.2,0,0,0,0" m=""/><S X="5209" Y="1239" T="5" L="204" H="32" P="0,0,6,0.2,14,0,0,0" m=""/><S X="5184" Y="1346" T="5" L="219" H="32" P="0,0,0,0.2,84,0,0,0" m=""/><S X="4893" Y="1267" T="4" L="10" H="84" P="0,0,20,0.2,0,0,0,0" m=""/><S X="4131" Y="1379" T="12" L="328" H="900" o="09020E" P="0,0,0.3,0.2,0,0,0,0"/><S X="6336" Y="1894" T="5" L="567" H="103" P="0,0,0.3,0.2,0,0,0,0" m=""/><S X="6656" Y="1860" T="5" L="569" H="103" P="0,0,0.3,0.2,-11,0,0,0" m=""/><S X="7269" Y="1876" T="5" L="569" H="103" P="0,0,0.3,0.2,15,0,0,0" m=""/><S X="6968" Y="1806" T="5" L="84" H="105" P="0,0,0.3,0.2,-1,0,0,0" m=""/><S X="7533" Y="1866" T="5" L="569" H="103" P="0,0,0.3,0.2,-1,0,0,0" m=""/><S X="5741" Y="1361" T="12" L="508" H="1537" o="050006" P="0,0,0.3,0.2,-180,0,0,0"/><S X="4796" Y="835" T="12" L="328" H="1537" o="08020E" P="0,0,0.3,0.2,-270,0,0,0"/><S X="4810" Y="1747" T="12" L="328" H="1719" o="080109" P="0,0,0.3,0.2,-90,0,0,0"/><S X="7845" Y="314" T="5" L="806" H="632" P="0,0,0,0.2,0,0,0,0" m=""/><S X="8728" Y="634" T="5" L="1192" H="129" P="0,0,0.3,0.2,1,0,0,0" m=""/><S X="9443" Y="392" T="5" L="806" H="632" P="0,0,0,0.2,0,0,0,0" m=""/><S X="8773" Y="751" T="13" L="209" H="79" o="324650" P="0,0,0.3,0.2,0,0,0,0" m=""/></S><D><DS X="428" Y="1359"/><P X="5109" Y="1194" T="4" P="1,0"/></D><O/><L/></Z></C>]])

text = lang[tfm.get.room.community] or lang.en

function eventNewPlayer(name)
	imgs[name] = {interfaceMouse = nil}
	tfm.exec.addImage("17068cffd23.png", "&1", 2, 354,name)
    tfm.exec.respawnPlayer(name)
	tfm.exec.setUIMapName("<font size='13'><BV>"..text.ModuleName.." ",name)
	if Map1 then
		tfm.exec.chatMessage("<CE>"..text.Welcome.."</CE>",name)
		ui.addTextArea(3, "<font size='12'><font color='#cf3872'><b>Heba", name, 1068 ,1550, 100, 100, 0x000000, 0x000000, 1, false)
		ui.addTextArea(-3, "<font size='12'><font color='#C3BBB1'><b>Noor", name,306,523, 100, 100, 0x000000, 0x000000, 1, false)
		ui.addTextArea(-4, "<font size='12'><font color='#693BCF'><b>Cyanny", name,3164 ,1350, 100, 100, 0x000000, 0x000000, 1, false)
		ui.addTextArea(4, "<a href='event:Heba'><font size='44'>\n \n \n \n \n \n \n \n \n \n \n \n ", name, 1070 ,1555, 100, 100, 0x000000, 0x000000, 1, false)
		ui.addTextArea(9, "<p align='center'><font size='15'><a href='event:cyanny'>\n \n \n \n \n \n ", name,3159,1357, 324, 83, 0x0, 0x0, 1, false)
		system.bindKeyboard(name,32, true, true)
		HebaImg[name] = tfm.exec.addImage("17025f7b378.png","!1",1066,1572,name)
		if FindKey1 > 2 and FindKey1 < 140 or TheEnd > 2 and TheEnd < 120 then
			tfm.exec.movePlayer(name,math.random(395,600),570,false,0,0,false) 
			tfm.exec.addPhysicObject(4,1300,516,{type=14, height=1130, width=1130, angle=0,color=nill, friction=0, restitution=0, dynamic=false,foreground=false,miceCollision=true})
		end
	else 
		ui.addTextArea(1001, "<a href='event:Ragee'><font size='44'>\n \n \n \n \n \n \n \n \n \n \n \n ", name, 845,720, 100, 100, 0x000000, 0x000000, 1, false)
	end
end

function eventPlayerLeft(name)
	if KeyFinder[name] or Taker[name] then 
		ui.removeTextArea(4,name)
		Finder[name] = true
		local player = tfm.get.room.playerList[name]
		tfm.exec.chatMessage("<font color='#F28662'>"..text.GoTakeKey.." "..name.." "..text.DropKey.." ",nil)
		ui.removeTextArea(4,name)
		Key1 = tfm.exec.addImage("170319adff8.png","!2",player.x,player.y+15,nil)
		game.keyInfo.x = player.x
		game.keyInfo.y = player.y
		ui.addTextArea(666, "<p align='center'><font size='15'><a href='event:TheKey'>\n \n \n \n \n \n ",nil,player.x ,player.y+15,70,50, 0x0, 0x0, 1, false)
		tfm.exec.removeImage(KeyTakeP,nil)
		KeyFinder[name] = false
		TakerChat = 0
		game.taker[name] = false
	end
end

function eventLoop()
	if bosses.massi.killing then
		ui.addTextArea(-9, "", nil, 8, 394, 7.86 * bosses.massi.health, 5, 0xE484C4, 0xE484C4, 1, true)
		e=e+1
		if e==1 then
			if bosses.massi.img then tfm.exec.removeImage(bosses.massi.img) end
			bosses.massi.img = tfm.exec.addImage("1702c321aea.png","!2",6899,1696)
		elseif e == 5 then
			tfm.exec.explosion(6895,1750,70,50,false)
		elseif e == 7 then
			tfm.exec.removeImage(bosses.massi.img)
			local id = tfm.exec.addShamanObject(34,6942,1742,1,-5000,0)
			tfm.exec.addImage("170355d68ad.png","#"..id,0,0)
			if bosses.massi.img then tfm.exec.removeImage(bosses.massi.img) end
		elseif e==10 then
			e=0
		end
	end
	if bosses.zalekha.killing then
		y=y+1
		C=C+1
		ui.addTextArea(1, "", nil, 8, 394, 7.86 * bosses.zalekha.health , 5, 0xf2bc66, 0xf2bc66, 1, true)
		if y==1 then
			ui.removeTextArea(-1,nil)
			Zalekha1 = tfm.exec.addImage("17020f4b81d.png","!2",514,486,nil)
			tfm.exec.removeImage(Zalekha3,nil)
		elseif y==10 then
			Zalekha2 = tfm.exec.addImage("17020f4eafe.png","!2",500,493,nil)
			ui.addTextArea(-1, "<p align='center'><N> "..text.ZalekhaChat[math.random(#text.ZalekhaChat)].."<font color='#F0E47C'> ["..text.ZalekhaName.."]", nil,490 ,460,180, 32, 0x010101, 0x010101, 0.8, false)
			tfm.exec.removeImage(Zalekha1,nil)
		elseif y==15 then
			tfm.exec.explosion(390,563,-200,600,false)
			Zalekha3 = tfm.exec.addImage("17020f5279b.png","!2",508,470,nil)
			tfm.exec.removeImage(Zalekha2,nil)
			for i=0,3 do
				tfm.exec.displayParticle(3,math.random(558,629),math.random(564,610),0,0.1,0,0.1)
			end
		elseif y==17 then
			y=0
		end
		if C==1 then
			NoorCrying1 = tfm.exec.addImage("17021b2379f.png","!1",296 ,535,nil)
			tfm.exec.removeImage(NoorCrying2)
		elseif C==2 then
			tfm.exec.removeImage(NoorCrying1)
			NoorCrying2 = tfm.exec.addImage("17021b3e6bc.png","!1",296 ,534,nil)
			C=0
		end
	end
	if Final then
		TheEnd=TheEnd+1
		if TheEnd==2 then
			tfm.exec.addPhysicObject(4,1300,516,{type=14, height=1130, width=1130, angle=0,color=nill, friction=0, restitution=0, dynamic=false,foreground=false,miceCollision=true})
			for n,p in pairs(tfm.get.room.playerList) do 
				tfm.exec.movePlayer(n,math.random(395,600),570,false,0,0,false) 
			end
		elseif TheEnd==5 then
			NoorBig = tfm.exec.addImage("1704abe3f69.png", "&1", 121, 225, nil)
			ui.addTextArea(20, "<p align='center'><font size='13'>"..text.ImFree.." ", nil,225, 305, 324, 70,0x010101,0x010101, 1, true)
		elseif TheEnd==15 then
			ui.addTextArea(20, "<p align='center'><font size='13'>"..text.ThanksYou.."", nil,225, 305, 324, 70,0x010101,0x010101, 1, true)
		elseif TheEnd==25 then
			ui.addTextArea(20, "<p align='center'><font size='13'>"..text.LetsParty.." ", nil,225, 305, 324, 70,0x010101,0x010101, 1, true)
		elseif TheEnd==35 then
			ui.addTextArea(20, "<p align='center'><font size='13'>"..text.LetsGo.."", nil,225, 305, 324, 70,0x010101,0x010101, 1, true)
		elseif TheEnd==40 then
			tfm.exec.removeImage(NoorBig,nil)
			ui.removeTextArea(20,nil)
			ui.addTextArea(969, "", nil, -20, -3, 845, 402, 0xffffff, 0x000000, 0.1, true)
		elseif TheEnd==41 then
			ui.addTextArea(969, "", nil, -20, -3, 845, 402, 0xffffff, 0x000000, 0.2, true)
		elseif TheEnd==42 then
			ui.addTextArea(969, "", nil, -20, -3, 845, 402, 0xffffff, 0x000000, 0.3, true)
		elseif TheEnd==43 then
			ui.addTextArea(969, "", nil, -20, -3, 845, 402, 0xffffff, 0x000000, 0.4, true)
		elseif TheEnd==44 then
			ui.addTextArea(969, "", nil, -20, -3, 845, 402, 0xffffff, 0x000000, 0.6, true)
		elseif TheEnd==45 then
			ui.addTextArea(969, "", nil, -20, -3, 845, 402, 0xffffff, 0x000000, 0.8, true)
		elseif TheEnd==46 then
			ui.addTextArea(969, "", nil, -20, -3, 845, 402, 0xffffff, 0x000000, 1, true)
			Helpers = tfm.exec.addImage("1574526a825.png", "&1", 148, 88, nil)
		elseif TheEnd==51 then
			Map1 = false
			tfm.exec.newGame([[<C><P Lua="" Ca="" L="1900" H="1070"/><Z><S><S i="0,0,1704fc51217.jpg"/><S i="860,740,17050001aae.png"/><S N="" i="1090,740,1704ff15654.png"/><S X="-171" Y="520" T="5" L="342" H="1129" P="0,0,0,0.2,0,0,0,0" m=""/><S X="1901" Y="517" T="5" L="350" H="1129" P="0,0,0,0.2,0,0,0,0" m=""/><S X="988" Y="852" T="5" L="1517" H="147" P="0,0,0.3,0.2,0,0,0,0" m=""/><S X="611" Y="751" T="5" L="224" H="75" P="0,0,0.3,0.2,0,0,0,0" m=""/><S X="637" Y="692" T="5" L="150" H="148" P="0,0,0.3,0.2,-35,0,0,0" m=""/><S X="606" Y="655" T="5" L="150" H="73" P="0,0,0.3,0.2,-78,0,0,0" m=""/><S X="569" Y="661" T="5" L="168" H="73" P="0,0,2,0.2,-58,0,0,0" m=""/><S X="641" Y="935" T="5" L="1517" H="147" P="0,0,0.3,0.2,0,0,0,0" m=""/><S X="127" Y="859" T="9" L="324" H="147" P="0,0,0,0,0,0,0,0" c="4" m=""/></S><D><DS X="1713" Y="766"/></D><O/><L/></Z></C>]])
			tfm.exec.setUIMapName("<font size='13'><BV>"..text.ModuleName.."",nil)
		elseif TheEnd==55 then
				ui.addTextArea(1000, "<font size='12'><font color='#FF6B00'><b>Ragekitteee", nil,844 ,715, 100, 100, 0x000000, 0x000000, 1, false)
				ui.addTextArea(-1001, "<a href='event:Ragee'><font size='44'>\n \n \n \n \n \n \n \n \n \n \n \n ", nil, 844 ,713, 100, 100, 0x000000, 0x000000, 1, false)
			tfm.exec.removeImage(Helpers,nil)
			for id= -666, 969 do
				ui.removeTextArea(id,nil)
			end
			tfm.exec.chatMessage(""..text.WeAreSafeNow.." ",nil)
		end
	end
	Game = Game + 1
	if Game==2 then
		tfm.exec.addPhysicObject(2,1820,1511,{type=14, height=1130, width=1130, angle=0,color=nill, friction=0, restitution=0, dynamic=false,foreground=false,miceCollision=true})
	elseif Game==42 then
			tfm.exec.addPhysicObject(2,3550 ,1442,{type=14, height=700, width=700, angle=0,color=nill, friction=0, restitution=0, dynamic=false,foreground=false,miceCollision=true})
	elseif Game==100 then
		tfm.exec.removePhysicObject(2)
	end
	if bosses.massi.health < 5 then
		bosses.massi.killing = false
		bosses.massi.talking = bosses.massi.talking + 1
		ui.removeTextArea(-8,nil)
		ui.removeTextArea(-9,nil)
		if bosses.massi.talking == 1 then
			tfm.exec.removePhysicObject(1)
			tfm.exec.chatMessage(text.Massi2)
		elseif bosses.massi.talking == 6 then
			tfm.exec.removeImage(bosses.massi.img)
			for i=0,6 do
				tfm.exec.displayParticle(3,math.random(6895,6949),math.random(1695,1749),0,0.1,0,0.1)
			end
		end
	end
	if bosses.zalekha.health < 5 then
		bosses.zalekha.talking = bosses.zalekha.talking + 1
		ui.removeTextArea(0,nil)
		ui.removeTextArea(-1,nil)
		ui.removeTextArea(1,nil)
		bosses.zalekha.killing = false
		if bosses.zalekha.talking == 1 then
		    tfm.exec.removeImage(Zalekha1,nil)
			tfm.exec.removeImage(Zalekha2,nil)
			tfm.exec.removeImage(Zalekha3,nil)
			tfm.exec.removeImage(NoorCrying1,nil)
			tfm.exec.removeImage(NoorCrying2,nil)
			ui.addTextArea(4, "<a href='event:NoorTalk'><font size='44'>\n \n \n \n \n \n \n \n \n \n \n \n ", name,289 ,529, 100, 100, 0x000000, 0x000000, 1, false)
			Noor = 	tfm.exec.addImage("1702c06e873.png","!1",296 ,534,nil)
			Zalekha = tfm.exec.addImage("16f6d89a920.png","!1",520,555,nil)
			tfm.exec.chatMessage(""..text.Zalekha1.." ",name)
		elseif bosses.zalekha.talking==2 then
			bosses.zalekha.going = tfm.exec.addImage("16f6d89a920.png","!1",550,555,nil)
			tfm.exec.removeImage(Zalekha,nil)
		elseif bosses.zalekha.talking == 3 then
			Zalekha = tfm.exec.addImage("16f6d89a920.png","!1",590,555,nil)
			tfm.exec.removeImage(bosses.zalekha.going,nil)
		elseif bosses.zalekha.talking == 4 then
			bosses.zalekha.going = tfm.exec.addImage("16f6d89a920.png","!1",630,555,nil)
			tfm.exec.removeImage(Zalekha,nil)
		elseif bosses.zalekha.talking==5 then
			Zalekha = tfm.exec.addImage("16f6d89a920.png","!1",670,555,nil)
			tfm.exec.removeImage(bosses.zalekha.going,nil)
		elseif bosses.zalekha.talking==6 then
			bosses.zalekha.going = tfm.exec.addImage("16f6d89a920.png","!1",700,555,nil)
			tfm.exec.removeImage(Zalekha,nil)
		elseif bosses.zalekha.talking==7 then
			Zalekha = tfm.exec.addImage("16f6d89a920.png","!1",730,555,nil)
			tfm.exec.removeImage(bosses.zalekha.going,nil)
		elseif bosses.zalekha.talking==8 then
			bosses.zalekha.going = tfm.exec.addImage("16f6d89a920.png","!1",760,555,nil)
			tfm.exec.removeImage(Zalekha,nil)
		elseif bosses.zalekha.talking==9 then
			Zalekha = tfm.exec.addImage("16f6d89a920.png","!1",790,555,nil)
			tfm.exec.removeImage(bosses.zalekha.going,nil)
		elseif bosses.zalekha.talking==10 then
			bosses.zalekha.going = tfm.exec.addImage("16f6d89a920.png","!1",820,555,nil)
			tfm.exec.removeImage(Zalekha,nil)
		elseif bosses.zalekha.talking==11 then
			Zalekha = tfm.exec.addImage("16f6d89a920.png","!1",850,555,nil)
			tfm.exec.removeImage(bosses.zalekha.going,nil)
			tfm.exec.removeImage(Zalekha,nil)
		end
	end
for name, player in next, tfm.get.room.playerList do
	for i,place in next,teleport do 
		local x , y, dX = place[1], place[2], place[3]
		local teleX, teleY = place[4], place[5]
		print(x..y..dX)
		if player.x > x - dX and player.x < x + dX and player.y > y - 90 and player.y < y + 90 then
			if not place[6] or place[6] and FindKey then
				tfm.exec.movePlayer(name, teleX, teleY, false, false)
			end
		end
	end
	if game.taker[name] then
		TakerChat = TakerChat+1
		if TakerChat==10 then
		    tfm.exec.chatMessage("<s>"..text.KeyTime, name)
		elseif TakerChat==25 then
		    tfm.exec.chatMessage("<s>"..text.KeyWillDropSoon, name)
		elseif TakerChat==30 then
			if KeyFinder then 
				ui.removeTextArea(4,name)
				Finder[name] = true
				local player = tfm.get.room.playerList[name]
				tfm.exec.chatMessage("<font color='#F28662'>"..text.GoTakeKey.." "..name.." "..text.DropKey.." ",nil)
				ui.removeTextArea(4,name)
				Key1 = tfm.exec.addImage("170319adff8.png","!2",player.x,player.y+15,nil)
				game.keyInfo.x = player.x
				print(player)
				game.keyInfo.y = player.y
				ui.addTextArea(666, "<p align='center'><font size='15'><a href='event:TheKey'>\n \n \n \n \n \n ",nil,player.x ,player.y+15,70,50, 0x0, 0x0, 1, false)
				tfm.exec.removeImage(KeyTakeP,nil)
				KeyFinder[name] = false
				TakerChat = 0
				game.taker[name] = false
			end
		end
	end
	if Finder[name] then
	u=u+1
		if u==15 then
			Finder[name] = false
			u=0
		end
	end
	if FindKey then 
	FindKey1=FindKey1+1
		if FindKey1==2 then
			NoorBig = tfm.exec.addImage("1704abe3f69.png", "&1", 121, 225, nil)
			tfm.exec.addPhysicObject(4,1300,516,{type=14, height=1130, width=1130, angle=0,color=nill, friction=0, restitution=0, dynamic=false,foreground=false,miceCollision=true})
			ui.addTextArea(20, ""..text.Noor.." ", nil,245, 305, 324, 70,0x010101,0x010101, 1, true)
        for n,p in pairs(tfm.get.room.playerList) do 
            tfm.exec.movePlayer(n,393,570,false,0,0,false) 
        end
		elseif FindKey1==35 then
			ui.addTextArea(20, "<p align='center'><font size='13'> "..text.Noor1, nil,245, 305, 324, 70,0x010101,0x010101, 1, true)
		elseif FindKey1==72 then
			ui.addTextArea(20, "<p align='center'><font size='13'> "..text.Noor2, nil,245, 305, 324, 70,0x010101,0x010101, 1, true)
		elseif FindKey1==108 then
			ui.addTextArea(20, "<p align='center'><font size='13'>"..text.Noor3, nil,245, 305, 324, 70,0x010101,0x010101, 1, true)
		elseif FindKey1==140 then
			tfm.exec.removeImage(NoorBig,nil)
			tfm.exec.removePhysicObject(4)
            tfm.exec.chatMessage("<font color='#F28662'>"..text.SearchForCageKey)
			ui.removeTextArea(20,nil)
			Key1 = tfm.exec.addImage("170319adff8.png","!2",5197 ,1431,nil)
			ui.addTextArea(666, "<p align='center'><font size='15'><a href='event:TheKey'>\n \n \n \n \n \n ", nil,5179 ,1417,70,50, 0x0, 0x0, 1, false)
		end
	end
------------قتال زليخة
		if not bosses.massi.fighting then
			if player.x > 6800 and player.x < 7110 and player.y > 1670 and player.y < 1822 then
				tfm.exec.addPhysicObject(1,6340,1395,{type=14, height=1130, width=1130, angle=0,color=nil, friction=0, restitution=0, dynamic=false,foreground=false,miceCollision=true})
				tfm.exec.chatMessage(""..text.Massi1)
				tfm.exec.chatMessage("<font color='#FF6B00'> "..text.MassiFight)
				ui.addTextArea(-8, "", nil, 6, 392, 790, 6, 0x030303, 0x030303, 1, true)
				bosses.massi.killing = true
				bosses.massi.fighting = true
			else
				bosses.massi.fighting = false
			end
		end
        if not bosses.zalekha.fighting then
            if player.x > 100 and player.x < 900 and player.y > 500 and player.y < 900 then
				NoorNotCrying = true
				NoorCage = tfm.exec.addImage("17024a4c8eb.png","!2",275 ,510)
                tfm.exec.chatMessage("<font color='#FEF7BF'> "..text.Zalekha2)
                tfm.exec.chatMessage("<font color='#F28662'>"..text.ZlekhaFight)
                bosses.zalekha.killing = true
                ui.addTextArea(0, "", nil, 6, 392, 790, 6, 0x030303, 0x030303, 1, true)
                bosses.zalekha.fighting = true
            else
                bosses.zalekha.fighting = false
            end
        end
    end
end

 
 
function eventKeyboard(name,key,down,x,y)
    local player = tfm.get.room.playerList[name]
	if key==32 then
		if bosses.zalekha.killing then
			if player.x > 465 and player.x < 735 and player.y > 500 and player.y < 900 then
				tfm.exec.playEmote (name, 26)
				bosses.zalekha.health = bosses.zalekha.health - bosses.zalekha.damage 
			end
		elseif bosses.massi.killing then 
			if player.x > 6877 and player.x < 7005 and player.y > 1710 and player.y < 1775 then
				tfm.exec.playEmote (name, 26)
				bosses.massi.health = bosses.massi.health - bosses.massi.damage
			end
		end
	end
end

function eventPlayerDied(name)
	tfm.exec.respawnPlayer(name)
end

function sizeMenu(name)
	local ids = 2
	if imgs[name].interfaceMouse then tfm.exec.removeImage(imgs[name].interfaceMouse) end
	imgs[name].interfaceMouse = tfm.exec.addImage("170535e92ce.png", "&1", 98, 245, name)
	ui.addTextArea(3, "<p align='center'><font size='12'>"..text.ChangeYourSize, name, 194, 304, 463, 70, 0x0d0d0d, 0x0, 1, true)
	for i, size in next, game.sizes do 
		ids = ids + 1
		ui.addTextArea(ids,"<a href='event:" .. i .. "'><font size='13'><p align='center'>"..text[tostring(i)], name, 218, 346, 76, 27, 0x38302e, 0xff8724, 1, true)
	end
end

function removeTexts(name)
	tfm.exec.removeImage(imgs[name].interfaceMouse)
	for id = 2, 9 do
		ui.removeTextArea(id, name)
	end
end

function talk(name, charId ,event, texts, img, x, y)
	if imgs[name].interfaceMouse then tfm.exec.removeImage(imgs[name].interfaceMouse,name) end
	if charId == 1 then 
		ui.addTextArea(4, "<a href='event:"..event.."'><font size='44'>\n \n \n \n \n \n \n \n \n \n \n \n ", name, 1070 ,1555, 100, 100, 0x0, 0x0, 1, false)
	elseif charId == 2 then 
		ui.addTextArea(9, "<p align='center'><font size='15'><a href='event:"..event.."'>\n \n \n \n \n \n ", name, 3166,1355, 324, 83, 0x0, 0x0, 1, true)
	end
	imgs[name].interfaceMouse = tfm.exec.addImage(img, "&66", x, y, name)
	ui.addTextArea(30, "<p align='center'><font size='13'>"..texts, name, 245, 305, 324, 70, 0x010101, 0x010101, 1, true)
	ui.addTextArea(31, "<p align='center'><font size='15'><a href='event:"..event.."'>\n \n \n \n \n \n ", name, 245, 289, 324, 83, 0x0, 0x0, 1, true)
	if event == "close" then 
		tfm.exec.removeImage(imgs[name].interfaceMouse)
		ui.removeTextArea(30, name)
		ui.removeTextArea(31, name)
	end
end

function eventTextAreaCallback(id,name,callback)
local player = tfm.get.room.playerList[name]
	if player.x > 800 and player.x < 990 and player.y > 700 then
		if callback=="Ragee" then
			sizeMenu(name)
		end
	elseif player.x > 973 and player.x < 1210 and player.y > 1540 then
		if callback=="Heba" then
			tfm.exec.removeImage(HebaImg[name],name)
			talk(name, 1 ,"Heba2", text.HebaCantTalk, "1704ac6eca2.png", 130, 247)
        	HebaImg[name] = tfm.exec.addImage("17025f7f34e.png","!2",1070,1572,name)
		elseif callback=="Heba2" then
			talk(name, 1, "Heba3", text.HebaGoAndTalkWithCyanny, "1704ac6eca2.png", 130, 247)
		elseif callback=="Heba3" then
			tfm.exec.removeImage(HebaImg[name],name)
			talk(name, 1, "close", text.HebaGoAndTalkWithCyanny, "1704ac6eca2.png", 130, 247)
			HebaImg[name] = tfm.exec.addImage("17025f7b378.png","!2",1066,1572,name)
		end
	elseif player.x > 3000 and player.x < 3300 and player.y > 1000 then
		if callback=="cyanny" then
			talk(name, 2, "cyanny1", text.CyannyFinallyHelp, "1704ac6c51f.png", 138, 223)
		elseif callback=="cyanny1" then
			talk(name, 2, "cyanny2", text.Cyanny, "1704ac6c51f.png", 138, 223)
		elseif callback=="cyanny2" then
			talk(name, 2, "cyannybye", text.CyannyGoToForest, "1704ac6c51f.png", 138, 223)
		elseif callback=="cyannybye" then
			talk(name, 2, "close", text.CyannyGoToForest, "1704ac6c51f.png", 138, 223)
		end
	elseif player.x > game.keyInfo.x - 70 and player.x < game.keyInfo.x + 100 and player.y > game.keyInfo.y - 100 and player.y < game.keyInfo.y + 100  then
		if not Finder[name] then
			if callback=="TheKey" then
				ui.removeTextArea(666,nil)
				tfm.exec.removeImage(Key1)
				tfm.exec.chatMessage("<font color='#F28662'> "..text.HoldTheKey.." "..name.." "..text.HoldTheKey1.." ",nil)
				KeyTakeP = tfm.exec.addImage("170319adff8.png","$"..name,0,0)
				ui.addTextArea(4, "<a href='event:OpenCage'><font size='44'>\n \n \n \n \n \n \n \n \n \n \n \n ", name,289 ,529, 100, 100, 0x000000, 0x000000, 1, false)
				game.keyInfo.finder[name] = true
				game.taker[name] = true
			end
		else
			tfm.exec.chatMessage("<s>"..text.WaitToTakeTheKey, name)
		end
	elseif player.x > 279 and player.x < 453 and player.y > 527 then
		if callback=="NoorTalk" then
			FindKey = true
			ui.removeTextArea(4)
		elseif callback=="OpenCage" then
			tfm.exec.removeImage(NoorCage)
			ui.removeTextArea(4)
			tfm.exec.removeImage(KeyTakeP)
			tfm.exec.chatMessage("<font color='#F28662'> "..string.format(text.OpenNoorCage, name))
			Final = true
			game.taker[name] = false
		end
	end
	for i, size in next, game.sizes do 
		if callback == game.sizes[tostring(i)] then 
			tfm.exec.changePlayerSize(name, size)
			removeTexts(name)
		end
	end
end

tfm.exec.setRoomMaxPlayers(6)
table.foreach(tfm.get.room.playerList, eventNewPlayer)